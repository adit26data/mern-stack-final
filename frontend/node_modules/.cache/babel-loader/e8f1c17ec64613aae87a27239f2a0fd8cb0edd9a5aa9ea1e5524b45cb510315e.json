{"ast":null,"code":"import _regeneratorRuntime from\"C:/Users/Adit/Desktop/mern-stack-final/frontend/node_modules/@babel/runtime/helpers/esm/regeneratorRuntime.js\";import _asyncToGenerator from\"C:/Users/Adit/Desktop/mern-stack-final/frontend/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";import React,{Fragment,useEffect,useRef}from\"react\";import CheckoutSteps from\"../Cart/CheckoutSteps\";import{useSelector,useDispatch}from\"react-redux\";import MetaData from\"../layout/Metadata\";import{Typography}from\"@mui/material\";import{useAlert}from\"react-alert\";import{CardNumberElement,CardCvcElement,CardExpiryElement,useStripe,useElements}from\"@stripe/react-stripe-js\";import axios from\"axios\";import\"./Payment.css\";import CreditCardIcon from\"@mui/icons-material/CreditCard\";import EventIcon from\"@mui/icons-material/Event\";import VpnKeyIcon from\"@mui/icons-material/VpnKey\";import{createOrder,clearErrors}from\"../../actions/orderAction\";import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";var Payment=function Payment(_ref){var history=_ref.history;var orderInfo=JSON.parse(sessionStorage.getItem(\"orderInfo\"));var dispatch=useDispatch();var alert=useAlert();var stripe=useStripe();var elements=useElements();var payBtn=useRef(null);var _useSelector=useSelector(function(state){return state.cart;}),shippingInfo=_useSelector.shippingInfo,cartItems=_useSelector.cartItems;var _useSelector2=useSelector(function(state){return state.user;}),user=_useSelector2.user;// const { error } = useSelector((state) => state.newOrder);\nvar paymentData={amount:Math.round(orderInfo.totalPrice*100)};var order={shippingInfo:shippingInfo,orderItems:cartItems,itemsPrice:orderInfo.subtotal,taxPrice:orderInfo.tax,shippingPrice:orderInfo.shippingCharges,totalPrice:orderInfo.totalPrice};var submitHandler=/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee(e){var config,_yield$axios$post,data,client_secret,result;return _regeneratorRuntime().wrap(function _callee$(_context){while(1)switch(_context.prev=_context.next){case 0:e.preventDefault();payBtn.current.disabled=true;_context.prev=2;config={headers:{\"Content-Type\":\"application/json\"}};_context.next=6;return axios.post(\"/api/v1/payment/process\",paymentData,config);case 6:_yield$axios$post=_context.sent;data=_yield$axios$post.data;client_secret=data.client_secret;if(!(!stripe||!elements)){_context.next=11;break;}return _context.abrupt(\"return\");case 11:_context.next=13;return stripe.confirmCardPayment(client_secret,{payment_method:{card:elements.getElement(CardNumberElement),billing_details:{name:user.name,email:user.email,address:{line1:shippingInfo.address,city:shippingInfo.city,state:shippingInfo.state,postal_code:shippingInfo.pinCode,country:shippingInfo.country}}}});case 13:result=_context.sent;if(result.error){payBtn.current.disabled=false;alert.error(result.error.message);}else{if(result.paymentIntent.status===\"succeeded\"){order.paymentInfo={id:result.paymentIntent.id,status:result.paymentIntent.status};dispatch(createOrder(order));history.push(\"/success\");}else{alert.error(\"There's some issue while processing payment \");}}_context.next=21;break;case 17:_context.prev=17;_context.t0=_context[\"catch\"](2);payBtn.current.disabled=false;alert.error(_context.t0.response.data.message);case 21:case\"end\":return _context.stop();}},_callee,null,[[2,17]]);}));return function submitHandler(_x){return _ref2.apply(this,arguments);};}();useEffect(function(){// if (error) {\n//     alert.error(error);\n//     dispatch(clearErrors());\n// }\n},[dispatch,alert]);return/*#__PURE__*/_jsxs(Fragment,{children:[/*#__PURE__*/_jsx(MetaData,{title:\"Payment\"}),/*#__PURE__*/_jsx(CheckoutSteps,{activeStep:2}),/*#__PURE__*/_jsx(\"div\",{className:\"paymentContainer\",children:/*#__PURE__*/_jsxs(\"form\",{className:\"paymentForm\",onSubmit:function onSubmit(e){return submitHandler(e);},children:[/*#__PURE__*/_jsx(Typography,{children:\"Card Info\"}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(CreditCardIcon,{}),/*#__PURE__*/_jsx(CardNumberElement,{className:\"paymentInput\"})]}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(EventIcon,{}),/*#__PURE__*/_jsx(CardExpiryElement,{className:\"paymentInput\"})]}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(VpnKeyIcon,{}),/*#__PURE__*/_jsx(CardCvcElement,{className:\"paymentInput\"})]}),/*#__PURE__*/_jsx(\"input\",{type:\"submit\",value:\"Pay - \\u20B9\".concat(orderInfo&&orderInfo.totalPrice),ref:payBtn,className:\"paymentFormBtn\"})]})})]});};export default Payment;","map":{"version":3,"names":["React","Fragment","useEffect","useRef","CheckoutSteps","useSelector","useDispatch","MetaData","Typography","useAlert","CardNumberElement","CardCvcElement","CardExpiryElement","useStripe","useElements","axios","CreditCardIcon","EventIcon","VpnKeyIcon","createOrder","clearErrors","jsx","_jsx","jsxs","_jsxs","Payment","_ref","history","orderInfo","JSON","parse","sessionStorage","getItem","dispatch","alert","stripe","elements","payBtn","_useSelector","state","cart","shippingInfo","cartItems","_useSelector2","user","paymentData","amount","Math","round","totalPrice","order","orderItems","itemsPrice","subtotal","taxPrice","tax","shippingPrice","shippingCharges","submitHandler","_ref2","_asyncToGenerator","_regeneratorRuntime","mark","_callee","e","config","_yield$axios$post","data","client_secret","result","wrap","_callee$","_context","prev","next","preventDefault","current","disabled","headers","post","sent","abrupt","confirmCardPayment","payment_method","card","getElement","billing_details","name","email","address","line1","city","postal_code","pinCode","country","error","message","paymentIntent","status","paymentInfo","id","push","t0","response","stop","_x","apply","arguments","children","title","activeStep","className","onSubmit","type","value","concat","ref"],"sources":["C:/Users/Adit/Desktop/mern-stack-final/frontend/src/component/Cart/Payment.js"],"sourcesContent":["import React, { Fragment, useEffect, useRef } from \"react\";\r\nimport CheckoutSteps from \"../Cart/CheckoutSteps\";\r\nimport { useSelector, useDispatch } from \"react-redux\";\r\nimport MetaData from \"../layout/Metadata\";\r\nimport { Typography } from \"@mui/material\";\r\nimport { useAlert } from \"react-alert\";\r\nimport {\r\n    CardNumberElement,\r\n    CardCvcElement,\r\n    CardExpiryElement,\r\n    useStripe,\r\n    useElements,\r\n} from \"@stripe/react-stripe-js\";\r\n\r\nimport axios from \"axios\";\r\nimport \"./Payment.css\";\r\nimport CreditCardIcon from \"@mui/icons-material/CreditCard\";\r\nimport EventIcon from \"@mui/icons-material/Event\";\r\nimport VpnKeyIcon from \"@mui/icons-material/VpnKey\";\r\nimport { createOrder, clearErrors } from \"../../actions/orderAction\";\r\n\r\nconst Payment = ({ history }) => {\r\n    const orderInfo = JSON.parse(sessionStorage.getItem(\"orderInfo\"));\r\n\r\n    const dispatch = useDispatch();\r\n    const alert = useAlert();\r\n    const stripe = useStripe();\r\n    const elements = useElements();\r\n    const payBtn = useRef(null);\r\n\r\n    const { shippingInfo, cartItems } = useSelector((state) => state.cart);\r\n    const { user } = useSelector((state) => state.user);\r\n    // const { error } = useSelector((state) => state.newOrder);\r\n\r\n\r\n    const paymentData = {\r\n        amount: Math.round(orderInfo.totalPrice * 100),\r\n    };\r\n\r\n    const order = {\r\n        shippingInfo,\r\n        orderItems: cartItems,\r\n        itemsPrice: orderInfo.subtotal,\r\n        taxPrice: orderInfo.tax,\r\n        shippingPrice: orderInfo.shippingCharges,\r\n        totalPrice: orderInfo.totalPrice,\r\n    };\r\n\r\n    const submitHandler = async (e) => {\r\n        e.preventDefault();\r\n\r\n        payBtn.current.disabled = true;\r\n\r\n        try {\r\n            const config = {\r\n                headers: {\r\n                    \"Content-Type\": \"application/json\",\r\n                },\r\n            };\r\n            const { data } = await axios.post(\r\n                \"/api/v1/payment/process\",\r\n                paymentData,\r\n                config\r\n            );\r\n\r\n            const client_secret = data.client_secret;\r\n\r\n            if (!stripe || !elements) return;\r\n\r\n            const result = await stripe.confirmCardPayment(client_secret, {\r\n                payment_method: {\r\n                    card: elements.getElement(CardNumberElement),\r\n                    billing_details: {\r\n                        name: user.name,\r\n                        email: user.email,\r\n                        address: {\r\n                            line1: shippingInfo.address,\r\n                            city: shippingInfo.city,\r\n                            state: shippingInfo.state,\r\n                            postal_code: shippingInfo.pinCode,\r\n                            country: shippingInfo.country,\r\n                        },\r\n                    },\r\n                },\r\n            });\r\n\r\n            if (result.error) {\r\n                payBtn.current.disabled = false;\r\n\r\n                alert.error(result.error.message);\r\n            } else {\r\n                if (result.paymentIntent.status === \"succeeded\") {\r\n                    order.paymentInfo = {\r\n                        id: result.paymentIntent.id,\r\n                        status: result.paymentIntent.status,\r\n                    };\r\n\r\n                    dispatch(createOrder(order));\r\n\r\n                    history.push(\"/success\");\r\n                } else {\r\n                    alert.error(\"There's some issue while processing payment \");\r\n                }\r\n            }\r\n        } catch (error) {\r\n            payBtn.current.disabled = false;\r\n            alert.error(error.response.data.message);\r\n        }\r\n    };\r\n\r\n    useEffect(() => {\r\n        // if (error) {\r\n        //     alert.error(error);\r\n        //     dispatch(clearErrors());\r\n        // }\r\n    }, [dispatch, alert]);\r\n\r\n    return (\r\n        <Fragment>\r\n            <MetaData title=\"Payment\" />\r\n            <CheckoutSteps activeStep={2} />\r\n            <div className=\"paymentContainer\">\r\n                <form className=\"paymentForm\" onSubmit={(e) => submitHandler(e)}>\r\n                    <Typography>Card Info</Typography>\r\n                    <div>\r\n                        <CreditCardIcon />\r\n                        <CardNumberElement className=\"paymentInput\" />\r\n                    </div>\r\n                    <div>\r\n                        <EventIcon />\r\n                        <CardExpiryElement className=\"paymentInput\" />\r\n                    </div>\r\n                    <div>\r\n                        <VpnKeyIcon />\r\n                        <CardCvcElement className=\"paymentInput\" />\r\n                    </div>\r\n\r\n                    <input\r\n                        type=\"submit\"\r\n                        value={`Pay - â‚¹${orderInfo && orderInfo.totalPrice}`}\r\n                        ref={payBtn}\r\n                        className=\"paymentFormBtn\"\r\n                    />\r\n                </form>\r\n            </div>\r\n        </Fragment>\r\n    );\r\n};\r\n\r\nexport default Payment;"],"mappings":"0RAAA,MAAO,CAAAA,KAAK,EAAIC,QAAQ,CAAEC,SAAS,CAAEC,MAAM,KAAQ,OAAO,CAC1D,MAAO,CAAAC,aAAa,KAAM,uBAAuB,CACjD,OAASC,WAAW,CAAEC,WAAW,KAAQ,aAAa,CACtD,MAAO,CAAAC,QAAQ,KAAM,oBAAoB,CACzC,OAASC,UAAU,KAAQ,eAAe,CAC1C,OAASC,QAAQ,KAAQ,aAAa,CACtC,OACIC,iBAAiB,CACjBC,cAAc,CACdC,iBAAiB,CACjBC,SAAS,CACTC,WAAW,KACR,yBAAyB,CAEhC,MAAO,CAAAC,KAAK,KAAM,OAAO,CACzB,MAAO,eAAe,CACtB,MAAO,CAAAC,cAAc,KAAM,gCAAgC,CAC3D,MAAO,CAAAC,SAAS,KAAM,2BAA2B,CACjD,MAAO,CAAAC,UAAU,KAAM,4BAA4B,CACnD,OAASC,WAAW,CAAEC,WAAW,KAAQ,2BAA2B,CAAC,OAAAC,GAAA,IAAAC,IAAA,gCAAAC,IAAA,IAAAC,KAAA,yBAErE,GAAM,CAAAC,OAAO,CAAG,QAAV,CAAAA,OAAOA,CAAAC,IAAA,CAAoB,IAAd,CAAAC,OAAO,CAAAD,IAAA,CAAPC,OAAO,CACtB,GAAM,CAAAC,SAAS,CAAGC,IAAI,CAACC,KAAK,CAACC,cAAc,CAACC,OAAO,CAAC,WAAW,CAAC,CAAC,CAEjE,GAAM,CAAAC,QAAQ,CAAG3B,WAAW,CAAC,CAAC,CAC9B,GAAM,CAAA4B,KAAK,CAAGzB,QAAQ,CAAC,CAAC,CACxB,GAAM,CAAA0B,MAAM,CAAGtB,SAAS,CAAC,CAAC,CAC1B,GAAM,CAAAuB,QAAQ,CAAGtB,WAAW,CAAC,CAAC,CAC9B,GAAM,CAAAuB,MAAM,CAAGlC,MAAM,CAAC,IAAI,CAAC,CAE3B,IAAAmC,YAAA,CAAoCjC,WAAW,CAAC,SAACkC,KAAK,QAAK,CAAAA,KAAK,CAACC,IAAI,GAAC,CAA9DC,YAAY,CAAAH,YAAA,CAAZG,YAAY,CAAEC,SAAS,CAAAJ,YAAA,CAATI,SAAS,CAC/B,IAAAC,aAAA,CAAiBtC,WAAW,CAAC,SAACkC,KAAK,QAAK,CAAAA,KAAK,CAACK,IAAI,GAAC,CAA3CA,IAAI,CAAAD,aAAA,CAAJC,IAAI,CACZ;AAGA,GAAM,CAAAC,WAAW,CAAG,CAChBC,MAAM,CAAEC,IAAI,CAACC,KAAK,CAACpB,SAAS,CAACqB,UAAU,CAAG,GAAG,CACjD,CAAC,CAED,GAAM,CAAAC,KAAK,CAAG,CACVT,YAAY,CAAZA,YAAY,CACZU,UAAU,CAAET,SAAS,CACrBU,UAAU,CAAExB,SAAS,CAACyB,QAAQ,CAC9BC,QAAQ,CAAE1B,SAAS,CAAC2B,GAAG,CACvBC,aAAa,CAAE5B,SAAS,CAAC6B,eAAe,CACxCR,UAAU,CAAErB,SAAS,CAACqB,UAC1B,CAAC,CAED,GAAM,CAAAS,aAAa,6BAAAC,KAAA,CAAAC,iBAAA,cAAAC,mBAAA,GAAAC,IAAA,CAAG,SAAAC,QAAOC,CAAC,MAAAC,MAAA,CAAAC,iBAAA,CAAAC,IAAA,CAAAC,aAAA,CAAAC,MAAA,QAAAR,mBAAA,GAAAS,IAAA,UAAAC,SAAAC,QAAA,iBAAAA,QAAA,CAAAC,IAAA,CAAAD,QAAA,CAAAE,IAAA,SAC1BV,CAAC,CAACW,cAAc,CAAC,CAAC,CAElBtC,MAAM,CAACuC,OAAO,CAACC,QAAQ,CAAG,IAAI,CAACL,QAAA,CAAAC,IAAA,GAGrBR,MAAM,CAAG,CACXa,OAAO,CAAE,CACL,cAAc,CAAE,kBACpB,CACJ,CAAC,CAAAN,QAAA,CAAAE,IAAA,SACsB,CAAA3D,KAAK,CAACgE,IAAI,CAC7B,yBAAyB,CACzBlC,WAAW,CACXoB,MACJ,CAAC,QAAAC,iBAAA,CAAAM,QAAA,CAAAQ,IAAA,CAJOb,IAAI,CAAAD,iBAAA,CAAJC,IAAI,CAMNC,aAAa,CAAGD,IAAI,CAACC,aAAa,MAEpC,CAACjC,MAAM,EAAI,CAACC,QAAQ,GAAAoC,QAAA,CAAAE,IAAA,kBAAAF,QAAA,CAAAS,MAAA,mBAAAT,QAAA,CAAAE,IAAA,UAEH,CAAAvC,MAAM,CAAC+C,kBAAkB,CAACd,aAAa,CAAE,CAC1De,cAAc,CAAE,CACZC,IAAI,CAAEhD,QAAQ,CAACiD,UAAU,CAAC3E,iBAAiB,CAAC,CAC5C4E,eAAe,CAAE,CACbC,IAAI,CAAE3C,IAAI,CAAC2C,IAAI,CACfC,KAAK,CAAE5C,IAAI,CAAC4C,KAAK,CACjBC,OAAO,CAAE,CACLC,KAAK,CAAEjD,YAAY,CAACgD,OAAO,CAC3BE,IAAI,CAAElD,YAAY,CAACkD,IAAI,CACvBpD,KAAK,CAAEE,YAAY,CAACF,KAAK,CACzBqD,WAAW,CAAEnD,YAAY,CAACoD,OAAO,CACjCC,OAAO,CAAErD,YAAY,CAACqD,OAC1B,CACJ,CACJ,CACJ,CAAC,CAAC,SAfIzB,MAAM,CAAAG,QAAA,CAAAQ,IAAA,CAiBZ,GAAIX,MAAM,CAAC0B,KAAK,CAAE,CACd1D,MAAM,CAACuC,OAAO,CAACC,QAAQ,CAAG,KAAK,CAE/B3C,KAAK,CAAC6D,KAAK,CAAC1B,MAAM,CAAC0B,KAAK,CAACC,OAAO,CAAC,CACrC,CAAC,IAAM,CACH,GAAI3B,MAAM,CAAC4B,aAAa,CAACC,MAAM,GAAK,WAAW,CAAE,CAC7ChD,KAAK,CAACiD,WAAW,CAAG,CAChBC,EAAE,CAAE/B,MAAM,CAAC4B,aAAa,CAACG,EAAE,CAC3BF,MAAM,CAAE7B,MAAM,CAAC4B,aAAa,CAACC,MACjC,CAAC,CAEDjE,QAAQ,CAACd,WAAW,CAAC+B,KAAK,CAAC,CAAC,CAE5BvB,OAAO,CAAC0E,IAAI,CAAC,UAAU,CAAC,CAC5B,CAAC,IAAM,CACHnE,KAAK,CAAC6D,KAAK,CAAC,8CAA8C,CAAC,CAC/D,CACJ,CAACvB,QAAA,CAAAE,IAAA,kBAAAF,QAAA,CAAAC,IAAA,IAAAD,QAAA,CAAA8B,EAAA,CAAA9B,QAAA,aAEDnC,MAAM,CAACuC,OAAO,CAACC,QAAQ,CAAG,KAAK,CAC/B3C,KAAK,CAAC6D,KAAK,CAACvB,QAAA,CAAA8B,EAAA,CAAMC,QAAQ,CAACpC,IAAI,CAAC6B,OAAO,CAAC,CAAC,yBAAAxB,QAAA,CAAAgC,IAAA,MAAAzC,OAAA,iBAEhD,kBA5DK,CAAAL,aAAaA,CAAA+C,EAAA,SAAA9C,KAAA,CAAA+C,KAAA,MAAAC,SAAA,OA4DlB,CAEDzG,SAAS,CAAC,UAAM,CACZ;AACA;AACA;AACA;AAAA,CACH,CAAE,CAAC+B,QAAQ,CAAEC,KAAK,CAAC,CAAC,CAErB,mBACIV,KAAA,CAACvB,QAAQ,EAAA2G,QAAA,eACLtF,IAAA,CAACf,QAAQ,EAACsG,KAAK,CAAC,SAAS,CAAE,CAAC,cAC5BvF,IAAA,CAAClB,aAAa,EAAC0G,UAAU,CAAE,CAAE,CAAE,CAAC,cAChCxF,IAAA,QAAKyF,SAAS,CAAC,kBAAkB,CAAAH,QAAA,cAC7BpF,KAAA,SAAMuF,SAAS,CAAC,aAAa,CAACC,QAAQ,CAAE,SAAAA,SAAChD,CAAC,QAAK,CAAAN,aAAa,CAACM,CAAC,CAAC,EAAC,CAAA4C,QAAA,eAC5DtF,IAAA,CAACd,UAAU,EAAAoG,QAAA,CAAC,WAAS,CAAY,CAAC,cAClCpF,KAAA,QAAAoF,QAAA,eACItF,IAAA,CAACN,cAAc,GAAE,CAAC,cAClBM,IAAA,CAACZ,iBAAiB,EAACqG,SAAS,CAAC,cAAc,CAAE,CAAC,EAC7C,CAAC,cACNvF,KAAA,QAAAoF,QAAA,eACItF,IAAA,CAACL,SAAS,GAAE,CAAC,cACbK,IAAA,CAACV,iBAAiB,EAACmG,SAAS,CAAC,cAAc,CAAE,CAAC,EAC7C,CAAC,cACNvF,KAAA,QAAAoF,QAAA,eACItF,IAAA,CAACJ,UAAU,GAAE,CAAC,cACdI,IAAA,CAACX,cAAc,EAACoG,SAAS,CAAC,cAAc,CAAE,CAAC,EAC1C,CAAC,cAENzF,IAAA,UACI2F,IAAI,CAAC,QAAQ,CACbC,KAAK,gBAAAC,MAAA,CAAYvF,SAAS,EAAIA,SAAS,CAACqB,UAAU,CAAG,CACrDmE,GAAG,CAAE/E,MAAO,CACZ0E,SAAS,CAAC,gBAAgB,CAC7B,CAAC,EACA,CAAC,CACN,CAAC,EACA,CAAC,CAEnB,CAAC,CAED,cAAe,CAAAtF,OAAO"},"metadata":{},"sourceType":"module","externalDependencies":[]}